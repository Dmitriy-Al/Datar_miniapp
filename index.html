<!DOCTYPE html>
<html>
<head>
    <title>Simple User Manager</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 20px auto; padding: 20px; }
        input, button { padding: 8px; margin: 5px; }
        .user-item { padding: 10px; border: 1px solid #ddd; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>User Manager 10</h1>
    
    <!-- Форма для добавления пользователя -->
    <div>
        <input type="text" id="userName" placeholder="Enter user name">
        <button onclick="addUser()">Add User</button>
    </div>

    <div>
      <button id="showUsers">Show Users</button>
    </div>
    
    <!-- Список пользователей -->
    <div id="usersList"></div>

        <div>
      <output id="text">  </output>
    </div>

    <script>// const API_BASE = 'https://176.123.166.19:8443/api';

        // Базовый URL вашего Spring Boot сервера на cloud.ru
        // ЗАМЕНИТЕ 'your-server-ip' на реальный IP вашего сервера http://176.123.166.19  https://alimovdev.ru/api/testdb
        const API_BASE = "https://alimovdev.ru/api"; //  const API_BASE = 'http://your-server-ip:8080/api'; 'http://localhost:8080/api/testdb'

        const use = document.getElementById("text");
        const showUsersButton = document.getElementById("showUsers");
        

        showUsersButton.addEventListener("click", () => {
            loadUsers();


            /*
            use.innerHTML = ' SHOW '
            const resp = fetch(API_BASE);
            use.innerHTML += ' < ' + resp + ' > ';
            */
              });
        
        // Функция для добавления нового пользователя
        async function addUser() {
            // Получаем значение из поля ввода
            const userNameInput = document.getElementById('userName');
            const name = userNameInput.value.trim();
            
            // Проверяем, что поле не пустое
            if (!name) {
                alert('Please enter a name');
                return;
            }

            /*
            origin 'null' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: 
            No 'Access-Control-Allow-Origin' header is present on the requested resource.
            */
            
            try {
                // Отправляем POST запрос на сервер для создания пользователя  function fetch(input: RequestInfo | URL, init?: RequestInit): Promise<Response>
                const response = await fetch(API_BASE + "/testdb", { //  const response = await fetch(API_BASE + '/users', {
                    method: 'POST', // Метод HTTP для создания данных
                    headers: {
                       //  'Access-Control-Allow-Origin': "localhost",
                        'Content-Type': 'application/json', // Указываем, что отправляем JSON
                    },
                    body: JSON.stringify({ // Преобразуем объект в JSON строку
                        name: name // Создаем объект с полем name
                        // Поле id не указываем - оно сгенерируется автоматически в БД
                    })
                });
                
                // Проверяем, что запрос выполнен успешно (статус 200-299)
                if (response.ok) {
                    // Очищаем поле ввода
                    userNameInput.value = '';
                    // Обновляем список пользователей
                   // loadUsers();
                } else {
                    // Если сервер вернул ошибку
                    throw new Error('Server returned error: ' + response.status);
                }
            } catch (error) {
                // Обрабатываем ошибки сети или другие ошибки
                console.error('Error adding user:', error);
                alert('Error adding user: ' + error.message + ' <> ' + error.value + ' <> ' + response.status + ' <> ' + response.message);
            }
        }
        
        /*  */ 
        // Функция для загрузки списка пользователей
        async function loadUsers() {
            try {
                // Отправляем GET запрос для получения всех пользователей
                const response = await fetch(API_BASE + "/testdb"); // const response = await fetch(API_BASE + '/users');
                
                // Проверяем успешность запроса
                if (!response.ok) {
                    throw new Error('Failed to load users: ' + response.status);
                }
                
                // Преобразуем ответ из JSON в JavaScript объект
                const users = await response.json();
                
                // Получаем контейнер для списка пользователей
                const usersList = document.getElementById('usersList');
                
                // Очищаем предыдущий список
                usersList.innerHTML = '';
                
                // Проверяем, есть ли пользователи
                if (users.length === 0) {
                    usersList.innerHTML = '<p>No users found</p>';
                    return;
                }
                
                // Для каждого пользователя создаем HTML элемент
                users.forEach(user => {
                    const userElement = document.createElement('div');
                    userElement.className = 'user-item';
                    userElement.innerHTML = `
                        <strong>ID:</strong> ${user.id} 
                        <strong>Name:</strong> ${user.name}
                        <button onclick="deleteUser(${user.id})">Delete</button>
                    `;
                    usersList.appendChild(userElement);
                });
                
            } catch (error) {
                // Обрабатываем ошибки
                console.error('Error loading users:', error);
                document.getElementById('usersList').innerHTML = 
                    '<p>Error loading users: ' + error.message + '</p>';
            }
        }
          

                
     
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Функция для удаления пользователя
        async function deleteUser(userId) {
            // Подтверждаем удаление
            if (!confirm('Are you sure you want to delete this user?')) {
                return;
            }
            
            try {
                // Отправляем DELETE запрос на сервер
                const response = await fetch(API_BASE + "/testdb" + '/' + userId, {  //  const response = await fetch(API_BASE + '/users/' + userId, { 
                    method: 'DELETE' // Метод HTTP для удаления данных
                });
                
                // Проверяем успешность запроса
                if (response.ok) {
                    // Обновляем список пользователей после удаления
                    loadUsers();
                } else {
                    throw new Error('Failed to delete user: ' + response.status);
                }
            } catch (error) {
                // Обрабатываем ошибки
                console.error('Error deleting user:', error);
                alert('Error deleting user: ' + error.message);
            }
        }
           
        /*
        // Загружаем пользователей при загрузке страницы
        // Эта функция выполнится, когда страница полностью загрузится
        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
        });
        */
        
        // Также можно обновлять список каждые 10 секунд
        // setInterval(loadUsers, 10000);
    </script>
</body>
</html>
